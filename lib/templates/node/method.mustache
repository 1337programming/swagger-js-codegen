/**
 * {{&summary}}
 * @method
 * @name {{&className}}#{{&methodName}}
{{#parameters}}
{{^isSingleton}} * @param {{=<% %>=}}{{<%&type%>}}<%={{ }}=%> {{&camelCaseName}} - {{&description}}{{/isSingleton}}
{{/parameters}}
 * 
 */
 this.{{&methodName}} = function(parameters){
    var deferred = Q.defer();

    var path = '{{&path}}';
    
    var body;
    var queryParameters = {};
    var headers = {};

    {{#parameters}}
        {{#required}}
        if(parameters.{{&camelCaseName}} === undefined){
            deferred.reject(new Error('Missing required {{&paramType}} parameter: {{&camelCaseName}}'));
            return deferred.promise;
        }
        {{/required}}

        {{#isQueryParameter}}
            queryParameters['{{&name}}'] = {{#isSingleton}}'{{singleton}}'{{/isSingleton}} {{^isSingleton}}parameters.{{&camelCaseName}}{{/isSingleton}};
        {{/isQueryParameter}}
        
        {{#isPathParameter}}
            path = path.replace('{{=<% %>=}}{<%&name%>}<%={{ }}=%>', parameters.{{&camelCaseName}});
        {{/isPathParameter}}
        
        {{#isHeaderParameter}}
            headers[{{&name}}] = {{#isSingleton}}'{{singleton}}'{{/isSingleton}} {{^isSingleton}}parameters.{{&camelCaseName}}{{/isSingleton}};;
        {{/isHeaderParameter}}

        {{#isBodyParameter}}
            body = parameters.{{&camelCaseName}};
        {{/isBodyParameter}}
        
    {{/parameters}}

    request({
        method: '{{method}}', 
        uri: domain + path,
        qs: queryParameters,
        headers: headers,
        body: body,
        rejectUnauthorized: false
    }, function(error, response, body){
        if(error) {
            deferred.reject(error);
        } else {
            if(/^application\/(.*\\+)?json/.test(response.headers['content-type'])) {
                try {
                    body = JSON.parse(body);
                } catch(e) {
                
                }
            }
            if(response.statusCode >= 200 && response.statusCode <= 299) {
               deferred.resolve({ response: response, body: body });
            } else {
               deferred.reject({ response: response, body: body });
            }
        }
    });
    
    return deferred.promise; 
 };
