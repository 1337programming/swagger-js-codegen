let req = request('{{method}}', domain + path)
.query(queryParameters);
Object.keys(headers).forEach(key => {
    req.set(key, headers[key]);
});

if(body) {
    req.send(body);
}

if(typeof(body) === 'object' && !(body instanceof Buffer)) {
    req.set('Content-Type', 'application/json');
}

if(Object.keys(form).length > 0) {
    req.type('form');
    req.send(form);
}

req.end((error, response) => {
    if(error) {
        reject(error);
    } else {
        if(/^application\/(.*\\+)?json/.test(response.header['content-type'])) {
            try {
                body = JSON.parse(body);
            } catch(e) {}
        }
        if(response.statusCode === 204) {
            resolve({ response: response });
        } else if(response.statusCode >= 200 && response.statusCode <= 299) {
            resolve({ response: response, body: body });
        } else {
            reject({ response: response, body: body });
        }
    }
});